@inherits LayoutComponentBase

<TopNavbar />

<CascadingValue Value="LayoutContext" IsFixed="false">

    <div class="modern-admin-layout">
        <header class="p-4 border-bottom">
            <h2 class="h1 mb-0 text-dark-emphasis">ðŸ“š Admin Dashboard</h2>
        </header>

        <nav class="sub-navbar bg-white shadow-sm">
            <div class="container-fluid py-3 px-4 d-flex justify-content-start flex-wrap gap-3">

                <button class="nav-btn btn btn-light d-flex align-items-center gap-2 @(LayoutContext.SelectedRole == "" ? "active-users" : "")"
                        @onclick="@(() => HandleRoleSelect(""))" title="All Users">
                    <i class="bi bi-people-fill fs-5"></i>
                    <span class="d-none d-md-inline">Users</span>
                </button>

                <button class="nav-btn btn btn-light d-flex align-items-center gap-2 @(LayoutContext.SelectedRole == "Subjects" ? "active-subjects" : "")"
                        @onclick="@(() => HandleRoleSelect("Subjects"))" title="Subjects">
                    <i class="bi bi-book fs-5"></i>
                    <span class="d-none d-md-inline">Subjects</span>
                </button>

                <button class="nav-btn btn btn-light d-flex align-items-center gap-2 @(LayoutContext.SelectedRole == "Notifications" ? "active-notifications" : "")"
                        @onclick="@(() => HandleRoleSelect("Notifications"))" title="Notifications">
                    <i class="bi bi-bell-fill fs-5"></i>
                    <span class="d-none d-md-inline">Notifications</span>
                </button>

            </div>
        </nav>

        <main class="container-fluid p-4">
            @Body
        </main>
    </div>

</CascadingValue>

@code {
    public class AdminLayoutContext
    {
        public string SelectedRole { get; set; } = string.Empty;
        public Action<string> RoleSelectedCallback { get; set; } = delegate { };
    }

    private AdminLayoutContext LayoutContext { get; set; } = new();

    private void HandleRoleSelect(string role)
    {
        LayoutContext.RoleSelectedCallback.Invoke(role);
        LayoutContext.SelectedRole = role;
        StateHasChanged();
    }

    public void SetContext(string selectedRole, Action<string> callback)
    {
        LayoutContext.SelectedRole = selectedRole;
        LayoutContext.RoleSelectedCallback = callback;
        StateHasChanged();
    }
}