@page "/auth/forgot-password"
@using IIT_Academica_DTOs
@using IIT_Academica_Front.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<h3 id="forgot-password-title">Forgotten Password Request ðŸ”‘</h3>
<p class="text-muted">Enter your account email address below, and we'll send you a link to reset your password.</p>

<hr />

@if (!string.IsNullOrEmpty(Message))
{
    @* ------------------- Message Alert (ID ADDED) ------------------- *@
    <div id="forgot-password-alert" class="alert @AlertClass" role="alert">
        @Message
    </div>
}

@* ------------------- Edit Form (ID ADDED) ------------------- *@
<EditForm id="forgot-password-form" Model="@Model" OnValidSubmit="@HandleForgotPassword">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group mb-3">
        <label for="email-input">Email Address</label>
        @* ------------------- Email Input (ID ADDED) ------------------- *@
        <InputText id="email-input" class="form-control" @bind-Value="Model.Email" />
        @* ------------------- Validation Message (ID ADDED) ------------------- *@
        <ValidationMessage id="email-validation-message" For="@(() => Model.Email)" />
    </div>

    @* ------------------- Submit Button (ID ADDED) ------------------- *@
    <button id="send-reset-link-btn" type="submit" class="btn btn-primary" disabled="@IsLoading">
        @if (IsLoading)
        {
            @* ------------------- Loading Spinner (ID ADDED) ------------------- *@
            <span id="submit-loading-spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"> Sending Request...</span>
            
        }
        else
        {
            <span>Send Reset Link</span>
        }
    </button>
</EditForm>

@code {
    private ForgetPasswordDto Model = new ForgetPasswordDto();
    private string Message = string.Empty;
    private string AlertClass = "alert-info";
    private bool IsLoading = false;

    private async Task HandleForgotPassword()
    {
        IsLoading = true;
        Message = string.Empty;
        
        // 1. Call the service to hit the API
        var result = await AuthService.ForgotPassword(Model);

        // 2. Handle the generic response
        if (result.IsSuccess)
        {
            Message = result.Message;
            AlertClass = "alert-success";
            // Optionally clear the email field: Model.Email = string.Empty;
        }
        else
        {
            // Note: The API should ideally always return IsSuccess=true here 
            // to prevent user enumeration. Failures here are usually API connection issues.
            Message = result.Message;
            AlertClass = "alert-danger";
        }

        IsLoading = false;
    }
}