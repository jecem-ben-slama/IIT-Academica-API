@page "/auth/forgot-password"
@using IIT_Academica_DTOs
@using IIT_Academica_Front.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<h3>Forgotten Password Request ðŸ”‘</h3>
<p class="text-muted">Enter your account email address below, and we'll send you a link to reset your password.</p>

<hr />

@if (!string.IsNullOrEmpty(Message))
{
    <div class="alert @AlertClass" role="alert">
        @Message
    </div>
}

<EditForm Model="@Model" OnValidSubmit="@HandleForgotPassword">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group mb-3">
        <label for="email">Email Address</label>
        <InputText id="email" class="form-control" @bind-Value="Model.Email" />
        <ValidationMessage For="@(() => Model.Email)" />
    </div>

    <button type="submit" class="btn btn-primary" disabled="@IsLoading">
        @if (IsLoading)
        {
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"> Sending Request...</span>
           
        }
        else
        {
            <span>Send Reset Link</span>
        }
    </button>
</EditForm>

@code {
    private ForgetPasswordDto Model = new ForgetPasswordDto();
    private string Message = string.Empty;
    private string AlertClass = "alert-info";
    private bool IsLoading = false;

    private async Task HandleForgotPassword()
    {
        IsLoading = true;
        Message = string.Empty;
        
        // 1. Call the service to hit the API
        var result = await AuthService.ForgotPassword(Model);

        // 2. Handle the generic response
        if (result.IsSuccess)
        {
            Message = result.Message;
            AlertClass = "alert-success";
            // Optionally clear the email field: Model.Email = string.Empty;
        }
        else
        {
            // Note: The API should ideally always return IsSuccess=true here 
            // to prevent user enumeration. Failures here are usually API connection issues.
            Message = result.Message;
            AlertClass = "alert-danger";
        }

        IsLoading = false;
    }
}