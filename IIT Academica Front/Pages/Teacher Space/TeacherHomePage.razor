@page "/teacher"
@inject NavigationManager NavigationManager
@inject IIT_Academica_Front.Services.SubjectService SubjectService

<TopNavbar/>

<div class="container mt-4">
    <h2 class="mb-4 text-primary">My Assigned Sections</h2>

    @if (isLoading)
    {
        <div class="text-center p-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading subjects...</p>
        </div>
    }
    else if (errorMessage != null)
    {
        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">Loading Error</h4>
            <p>@errorMessage</p>
            <hr>
            <p class="mb-0">Please check your network connection or try logging in again.</p>
        </div>
    }
    else if (Subjects == null || !Subjects.Any())
    {
        <div class="alert alert-info" role="alert">
            <h4 class="alert-heading">No Subjects Assigned</h4>
            <p class="mb-0">You currently have no subjects or sections assigned to you.</p>
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            @foreach (var subject in Subjects)
            {
                <div class="col">
                    <div class="subject-card h-100 shadow-sm border-0" @onclick="() => GoToMaterials(subject.Id)">
                        <div class="card-body">
                            <h5 class="card-title text-dark">@subject.SubjectName</h5>
                            <p class="card-text text-muted">Section ID: **@subject.Id**</p>
                        </div>
                        <div class="card-footer bg-transparent border-top-0 d-grid">
                            <button class="btn btn-sm btn-primary btn-manage">
                                Manage Materials
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    // Assuming SubjectDTO is available via a using statement or defined in IIT_Academica_Front.Models
    // For compilation, ensure the DTO is accessible.
    // Placeholder for required DTO:
   

    private List<SubjectDTO>? Subjects;
    private string? errorMessage;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Subjects = await SubjectService.GetMySectionsAsync();
        }
        catch (HttpRequestException ex)
        {
            errorMessage = $"Failed to connect to the API or authorization error occurred. Details: {ex.Message}";
        }
        catch (Exception)
        {
            errorMessage = "An unexpected error occurred while fetching subjects.";
        }
        finally
        {
            isLoading = false;
        }
    }

    private void GoToMaterials(int subjectId)
    {
        NavigationManager.NavigateTo($"/teacher/subject/{subjectId}/materials");
    }
}